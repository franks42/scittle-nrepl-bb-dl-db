<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MCP-nREPL Joyride Environment</title>
  <!-- Set WebSocket port BEFORE loading Scittle nREPL -->
  <script>var SCITTLE_NREPL_WEBSOCKET_PORT = 1340;</script>
  <script src="https://unpkg.com/scittle@0.3.10/dist/scittle.js"></script>
  <script src="https://unpkg.com/scittle@0.3.10/dist/scittle.nrepl.js"></script>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    .status { 
      padding: 10px; 
      border-radius: 8px; 
      margin: 10px 0;
      background: #2a2a2a;
      border-left: 4px solid #007acc;
    }
    .output { 
      background: #000; 
      color: #0f0; 
      padding: 15px; 
      border-radius: 8px; 
      font-family: 'Courier New', monospace;
      margin: 10px 0;
      min-height: 100px;
      white-space: pre-wrap;
    }
    .ports {
      background: #333;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .test-commands {
      background: #2a2a2a;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      border: 1px solid #444;
    }
    .test-commands code {
      display: block;
      background: #000;
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      color: #0f0;
    }
  </style>
</head>
<body>
  <h1>üöÄ MCP-nREPL Joyride Environment</h1>
  
  <div class="ports">
    <h3>üîó Server Configuration (Fixed Ports)</h3>
    <div>nREPL Bridge Port: <strong>1339</strong></div>
    <div>WebSocket Port: <strong>1340</strong></div>
    <div>HTTP Server: <strong>37373</strong></div>
  </div>
  
  <div class="status" id="status">‚úÖ Ready - Using fixed ports</div>
  <div class="output" id="output">Ready for evaluation...
</div>
  
  <div class="test-commands">
    <h3>üß™ Test Commands (run from terminal):</h3>
    <code>bb nrepl-eval '(+ 1 2 3)' 1339</code>
    <code>bb nrepl-eval '(js/alert "Hello from Scittle!")' 1339</code>
    <code>bb nrepl-eval '(js/console.log "Check browser console")' 1339</code>
    <code>bb nrepl-eval '(js/document.getElementById "output").innerHTML)' 1339</code>
  </div>
  
  <script type="application/x-scittle">
    (println "üéØ Scittle nREPL ready on WebSocket port 1340")
    (println "‚úÖ Browser-side Clojure evaluation enabled")
    
    ;; Add some test functions available in browser
    (defn browser-test []
      (str "Browser test at " (.toISOString (js/Date.))))
    
    (defn update-output [text]
      (set! (.-innerHTML (js/document.getElementById "output")) 
            (str (.-innerHTML (js/document.getElementById "output")) "\n" text)))
    
    (println "üìù Available functions: (browser-test) (update-output text)")
  </script>
  
  <script>
    // Log that we're ready with fixed ports
    console.log('üéØ MCP-nREPL Joyride ready with fixed ports:');
    console.log('   ‚Ä¢ nREPL Bridge: 1339');
    console.log('   ‚Ä¢ WebSocket: 1340 (SCITTLE_NREPL_WEBSOCKET_PORT)');
    console.log('   ‚Ä¢ HTTP Server: 37373');
    
    // Update status to show connection info
    window.addEventListener('load', () => {
      const statusEl = document.getElementById('status');
      statusEl.innerHTML = '‚úÖ Ready - Scittle nREPL on WebSocket 1340';
      statusEl.style.borderColor = '#28a745';
    });
  </script>
</body>
</html>